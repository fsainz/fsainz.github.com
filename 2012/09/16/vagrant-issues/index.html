<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Fernando Sainz personal blog">

    <title>Vagrant Issues - fsainz</title>

    <link rel="canonical" href="http://www.fsainz.com/2012/09/16/vagrant-issues/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <link rel="stylesheet" href="../css/lightgallery.min.css" />
    <link rel="stylesheet" href="../css/lg-transitions.min.css" />
    <link rel="stylesheet" href="../css/lightgallery-custom.css" />

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>


<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button
        type="button"
        class="navbar-toggle"
        data-toggle="collapse"
        data-target="#bs-example-navbar-collapse-1"
      >
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">fsainz</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav navbar-right">
        <li>
          <a href="/">Home</a>
        </li>
        
        <li>
          <a href="/about/">About</a>
        </li>
        
        <li>
          <a href="/projects/">projects</a>
        </li>
        
        <li>
          <a href="//www.fsainz.com/bonn">Bonn</a>
        </li>
      </ul>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>


    <!-- Post Header -->
<header class="intro-header">
</header>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">

				<h1 id="vagrant-issues">Vagrant Issues</h1>

<p class="meta">September 16th, 2012 - Madrid</p>

<p><img src="/img/vagrant.jpg" /></p>

<p><br /></p>

<p><a href="http://vagrantup.com/">Vagrant</a> is a very useful tool to work develop within virtual environments, which let’s you mimic more precisely your server in any development machine, share the exact same environment between developers and get a new machine ready for development in a faster and more predictable way.</p>

<p>We’ve been using it for almost a year now and we’ve compiled this list
of issues and solutions:</p>

<p>###NFS Problems</p>

<blockquote>
  <p>“Mounting NFS shared folders failed. This is most often caused by the NFS
 client software not being installed on the guest machine. Please verify
 that the NFS client software is properly installed, and consult any resources
 specific to the linux distro you’re using for more information on how to
 do this.”</p>
</blockquote>

<p>In spite of that “most often caused”, that’s never been our case, to
rule it out try this on your vagrant machine:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt-get install nfs-common -y
sudo shutdown -r now &amp;&amp; exit
</code></pre></div></div>

<p>We had that error message after messing with several boxes at the same
time, and also after copying a vagrant folder from one project to the
other, see <em>wrong virtualbox - vagrant - project association</em>
<br /></p>

<p>###RAILS server behaving very slow, getting to extremely slow when offline
from the vagrant website: “In order to keep SSH access speedy even when your host computer can’t access the internet, be sure to set UseDNS to no in /etc/ssh/sshd_config. This will disable DNS lookup of clients connecting to the server, which speeds up SSH connection.”</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo bash -c "echo 'UseDNS no' &gt;&gt; /etc/ssh/sshd_config"
</code></pre></div></div>

<p>to prevent webrick from doing this reverse dns lookup, locate the
webrick/config.rb of your webrick gem and change the line <code>:DoNotReverseLookup =&gt; nil,</code>
to <code>true</code></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sudo vi /usr/local/rbenv/versions/1.9.2-p290/lib/ruby/1.9.1/webrick/config.rb

:DoNotReverseLookup =&gt; true,
</code></pre></div></div>

<p><br /></p>

<p>###Interface flags error</p>
<blockquote>
  <p>SIOCSIFADDR: No such device<br />
   eth1: ERROR while getting interface flags: No such device<br />
   SIOCSIFNETMASK: No such device<br />
   eth1: ERROR while getting interface flags: No such device<br />
   Failed to bring up eth1.<br /></p>
</blockquote>

<p>we had this problem some times after packaging. It’s related to the way
ubuntu and debian cache the network interfaces configuration, the MAC of
one developer machine was being stored and causing trouble when other
developer tried to use the same box. To fix it just get ride of this file
<code>/etc/udev/rules.d/70-persistent-net.rules</code> and restart the machine.
<br /></p>

<p>###Wrong virtualbox - vagrant - project association</p>

<p>Vagrant creates an association between his boxes and the Virtualbox images in vagrant/.vagrant (basically just a string identifying the machine for each environment), if you are unaware of this as we were and copy this file accidentally to other project very weird things can happen.
If your machines are driving you mad and you want to start all over
again, delete your <code>.vagrant</code>, go to <code> ~/.vagrant.d/boxes </code> and wipe out your boxes, go to <code>~/VirtualBox\ VMs/
</code> and trash your images.</p>

<p>If you don’t want to be so drastic, these commands are useful for
troubleshooting and keeping an eye on orphan machines:</p>

<ul>
  <li>
    <p><code>vagrant status</code> to see the state of your machines and shut
them down if you plan to remove them.</p>
  </li>
  <li>
    <p><code>vagrant destroy</code> to remove the association in .vagrant and
the virtual image.</p>
  </li>
  <li>
    <p><code>vagrant box list</code> shows your available boxes (those stored in ~/.vagrant.d/boxes)</p>
  </li>
  <li>
    <p><code>VBoxManage list vms</code> shows the Virtual Box machines (in VirtualBox\ VMs/)</p>
  </li>
  <li>
    <p><code>vagrant destroy box <em>X</em></code> to remove the box <em>X</em></p>
  </li>
  <li>
    <p><code> VBoxManage unregistervm   \&lt;uuid\&gt;|\&lt;name\&gt; [--delete]</code> to delete a VM machine</p>
  </li>
</ul>

<p>For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant git:(master) VBoxManage list vms

"vagrant_1340547733" {7cb51e25-9296-464c-8686-43c3c8b4e1a8}
"vagrant_1343747935" {e22b8a76-b0c4-42a9-87cf-68bbce78c804}
"vagrant_1344073912" {1987c417-1d94-4eac-81f8-d9cd89f3b9c8}
"vagrant_1344074484" {5a80d54a-aff9-4ed4-a077-54d6e7213b0b}
</code></pre></div></div>

<p>let’s say that the uuid {e22b8a76-b0c4-42a9-87cf-68bbce78c804} is the
one for production specified in your .vagrant:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#.vagrant
{"active":{"production":"e22b8a76-b0c4-42a9-87cf-68bbce78c804","development":"a447fdcf-b1ed-4a18-8801-fcb767df0a56"}}
</code></pre></div></div>

<p>you could just type <code>vagrant destroy production</code> to both the
machine and the key in .vagrant, but if you wanted to do it manually you
could type:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VBoxManage unregistervm e22b8a76-b0c4-42a9-87cf-68bbce78c804 --delete
</code></pre></div></div>

<p><br />
###Vagrant user is being prompted for a sudo password</p>
<blockquote>
  <p>[default] – v-root: /vagrant
The following SSH command responded with a non-zero exit status.
Vagrant assumes that this means the command failed!</p>
</blockquote>

<p>You need to edit your sudoers table (see http://vagrantup.com/v1/docs/base_boxes.html, “Setup Permissions”), for example</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># sudo visudo  #edits /etc/sudoers

ALL ALL=(ALL) NOPASSWD: ALL
%staff ALL=(ALL) NOPASSWD: ALL
</code></pre></div></div>

<p><br />
###vagrant reload doesn’t work
Sometimes is enough ssh’ing your vagrant and restart after a
<code>sudo /etc/init.d/networking restart </code></p>

<p><br /></p>

<p>###File owner and permissions going nuts  (????:????)
That happenend to us quite often before switching to NFS (that’s the
best solution), alternatively, a restart does also the trick.</p>

<p><br /></p>
<h3 id="port-forwarding-doesnt-work-for-certain-port-numbers">Port Forwarding doesn’t work for certain port numbers</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Vagrant::Config.run do |config|
  config.vm.define :dev do |dev_config|
    dev_config.vm.box = "orlyboxdev"

    # http://coderwall.com/p/zdnscw
    # this allows vagrant to forward ports between 1 and 1024
    if ["up", "resume"].include? ARGV[0]
      system %{ sudo sysctl -w net.inet.ip.forwarding=1 }
      system %{ sudo ipfw add fwd 127.0.0.1,8080 tcp from any to any 80  "in" }
      system %{ sudo ipfw add fwd 127.0.0.1,8443 tcp from any to any 443 "in" }
    end

    dev_config.vm.forward_port 3000, 3000 # web in development
    dev_config.vm.forward_port 443,  8443 # web in development through NGINX with SSL
    dev_config.vm.forward_port 80,   8080 # web in development through NGINX

    # (...)
  end
end
</code></pre></div></div>

<p><br /></p>
<h3 id="ns_error_failure">NS_ERROR_FAILURE</h3>

<p>If you get this message:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Progress state:
VBoxManage: error: Failed to create the host-only adapter
VBoxManage: error: VBoxNetAdpCtl: Error while adding new interface: failed to open /dev/vboxnetctl: No such file or directory
</code></pre></div></div>

<p>try a</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo /Library/StartupItems/VirtualBox/VirtualBox restart
</code></pre></div></div>


                <hr>

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2012/09/13/wide-teams/" data-toggle="tooltip" data-placement="top" title="Wide Teams">&larr; Previous Post</a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2012/10/21/rails-https-and-non-standard-ports-in-vagrant/" data-toggle="tooltip" data-placement="top" title="Rails https and non-standard ports in vagrant">Next Post &rarr;</a>
                    </li>
                    
                </ul>

            </div>
        </div>
    </div>
</article>

<hr>


    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="/feed.xml">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    <li>
                        <a target="_blank" href="https://github.com/fsainz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="http://codepen.io/fsainz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-codepen fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="https://speakerdeck.com/fsainz/">
                          <span class="fa-stack fa-lg">
                            <svg width="50px" height="50px" viewBox="0 0 512 512" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                                <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd" sketch:type="MSPage">
                                    <path d="M256,512 C397.384903,512 512,397.384903 512,256 C512,114.615097 397.384903,0 256,0 C114.615097,0 0,114.615097 0,256 C0,397.384903 114.615097,512 256,512 Z M157.00292,151 C136.014487,151 119,168.007298 119,188.999 L119,323.001 C119,343.987268 136.020832,361 157.00292,361 L355.99708,361 C376.985513,361 394,343.992702 394,323.001 L394,188.999 C394,168.012732 376.979168,151 355.99708,151 L157.00292,151 Z M213.327471,218.914007 C201.732729,218.914007 192.333333,228.319857 192.333333,239.90541 L192.333333,272.040251 C192.333333,283.633483 201.743977,293.031654 213.327471,293.031654 L299.672529,293.031654 C311.267271,293.031654 320.666667,283.625804 320.666667,272.040251 L320.666667,239.90541 C320.666667,228.312179 311.256023,218.914007 299.672529,218.914007 L213.327471,218.914007 Z M210.470588,255.972831 L247.529412,237.639497 L247.529412,274.306164 L210.470588,255.972831 Z M264.279134,274.502243 L264.279134,237.443419 L300.945801,255.972831 L264.279134,274.502243 Z" id="sliderdeck" fill="#404040" sketch:type="MSShapeGroup"></path>
                                </g>
                            </svg>
                          </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="http://fsainz.tumblr.com/">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-tumblr fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="https://de.linkedin.com/in/fernandosainz">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li>
                        <a target="_blank" href="mailto:info@fsainz.com">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">
                  Copyright &copy; fsainz 2026
                  <br />
                  Theme adapted from <a class='text-muted' href="https://github.com/IronSummitMedia/startbootstrap-clean-blog-jekyll">startbootstrap-clean-blog-jekyll</a>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>

<script src="../js/lightgallery-all.min.js"></script>

<script>
  
</script>


</body>

</html>
